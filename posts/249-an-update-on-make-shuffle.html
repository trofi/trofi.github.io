<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>trofi's blog: A small update on 'make --shuffle' mode</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/code.css" />
        <link rel="stylesheet" type="text/css" href="../css/highlighting-kate.css" />

        <link rel="alternate" type="application/atom+xml" href="../feed/atom.xml" title="Atom 1.0" />
        <link rel="alternate" type="application/rss+xml" href="../feed/rss.xml" title="RSS 2.0" />
        <link rel="shortcut icon" href="../images/favicon.ico" />
    </head>
    <body>
        <div id="header">
            <a href="../">main :: IO ()</a>
        </div>
        <div id="navigation">
            <a href="../">/root</a>
            <a href="../archive.html">/archive</a>
            <a href="../feed/atom.xml">/atom.xml</a>
            <a href="../feed/rss.xml">/rss.xml</a>
        </div>

        <div id="content">
            <h1>A small update on 'make --shuffle' mode</h1>

            <h1 id="tldr">Tl;DR</h1>
<p>GNU Make --shuffle mode <a href="https://git.savannah.gnu.org/cgit/make.git/commit/?id=621d3196fae94e9006a7e9c5ffdaf5ec209bf832">entered upstream git repository</a> \o/.</p>
<p>For testing convenience I also tarballed the development <strong>GNU make</strong>
snapshot from today’s <a href="https://git.savannah.gnu.org/cgit/make.git/commit/?id=84ed34ba5a32dd52600c756445f3724c9e23cf95">git state</a>:
<a href="https://slyfox.uni.cx/distfiles/make/make-4.3.90.20220619.tar.lz" class="uri">https://slyfox.uni.cx/distfiles/make/make-4.3.90.20220619.tar.lz</a>.</p>
<p>Note that <strong>--shuffle</strong> is not enabled by default. You can enable it
by any of below methods whichever matches best your environment:</p>
<ul>
<li>Run <strong>make --shuffle</strong>. For casual testing.</li>
<li>Export <strong>MAKEFLAGS=--shuffle</strong> environment variable. For day-to-day
development or distribution-wide testing. It is also a safe value
for <strong>GNU make</strong> that does not yet understand <strong>--shuffle</strong> option.</li>
<li>Apply <a href="https://slyfox.uni.cx/distfiles/make/make-4.3.90.20220619-random-by-default.patch" class="uri">https://slyfox.uni.cx/distfiles/make/make-4.3.90.20220619-random-by-default.patch</a>
on top of snapshot tarball. Useful for environments where there is no
easy way to pass a parameter to <strong>make</strong> or to set <strong>MAKEFLAGS</strong>
variable.</li>
</ul>
<h1 id="minor-improvements">minor improvements</h1>
<p>Compared to the initial patch announced as a
<a href="../posts/238-new-make-shuffle-mode.html">proof of concept</a>
there is one extra change: presence of <strong>.NOTPARALLEL:</strong> directive
in a <strong>Makefile</strong> now disables shuffling in that file.</p>
<p>It was done to accomodate rare projects that rely on execution order
specified in <strong>Makefile</strong> and don’t plan to make dependencies correct
in near future. The example is <strong>netpbm</strong>:
<a href="https://sourceforge.net/p/netpbm/code/HEAD/tree/trunk/GNUmakefile#l110" class="uri">https://sourceforge.net/p/netpbm/code/HEAD/tree/trunk/GNUmakefile#l110</a></p>
<h1 id="failure-examples">failure examples</h1>
<p>A few new bugs were found and/or fixed:</p>
<ul>
<li>vim: <a href="https://github.com/vim/vim/pull/9978" class="uri">https://github.com/vim/vim/pull/9978</a></li>
<li>groff: <a href="https://savannah.gnu.org/bugs/?62084" class="uri">https://savannah.gnu.org/bugs/?62084</a></li>
<li>gpm: <a href="https://github.com/telmich/gpm/pull/43" class="uri">https://github.com/telmich/gpm/pull/43</a></li>
<li>gnu-efi: <a href="https://sourceforge.net/p/gnu-efi/patches/84/" class="uri">https://sourceforge.net/p/gnu-efi/patches/84/</a></li>
<li>cmigemo: <a href="https://github.com/koron/cmigemo/pull/29" class="uri">https://github.com/koron/cmigemo/pull/29</a></li>
<li>harvid: <a href="https://github.com/NixOS/nixpkgs/pull/178647" class="uri">https://github.com/NixOS/nixpkgs/pull/178647</a></li>
</ul>
<p>Nothing complicated. Just a few missing dependencies.</p>
<p>Give it a try!</p>

<div class="info">
    Posted on June 21, 2022 by trofi. <a href="mailto:slyich@gmail.com">Email</a>,
    <a href="https://github.com/trofi/trofi.github.io.gen">pull requests or comments</a>
    are welcome!
</div>

        </div>
        <div id="footer">
            powered by <a href="http://jaspervdj.be/hakyll">hakyll</a>
        </div>
    </body>
</html>
